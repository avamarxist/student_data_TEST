<html>
    <head>
        <%- include('../partials/head') %>
    </head>
    <body>
        <%- include('../partials/dashboard') %>
        <%- include('../partials/messages') %>

        <form method="GET" action="/entries/attendance/add">
            <div class="form-group row">
                <div class="form-group col-xs-5">
                    <label for="date">Date: </label>
                    <% let dateValue = ""; if(params.date){dateValue=params.date}  %>
                    <input type="date" class="form-control" id="dateSelect" name="date" value="<%- dateValue %>">
                </div>
                <div class="form-group col-xs-6">
                    <label for="course">Select course</label>
                    <select class="form-control" id="courseSelect" name="course">
                        <option value="">No course selected</option>
                        <% for(let c of data.activeCourses){ %>
                            <% let isSelected=""; if(params.course == c._id){isSelected = "selected"} %>
                            <option value="<%- c._id %>" <%- isSelected %> ><%= `Pd. ${c.period} - ${c.code}` %></option>
                        <% } %>
                    </select>
                </div> 
                <div class="form-group col-xs-6">
                    <label for="period">Select students by period</label>
                    <select class="form-control" id="courseSelect" name="period">
                        <option value="">No period selected</option>
                        <% for(let i = 1; i<=8; i++){ %>
                            <% let isSelected=""; if(params.period == i){isSelected = "selected"} %>
                            <option value="<%- i %>" <%- isSelected %> ><%= `Period ${i}` %></option>
                        <% } %>
                    </select>
                </div> 
            </div>
            <div class="form-actions">
                <button type="submit" class="btn btn-primary" >Generate attendance sheet</button>
            </div>
        </form>


        <form method = POST action="/entries/attendance/add">
            <input type="hidden" id="courseValue" name = "course" value="<%- params.course %>">
            <input type="hidden" id="dateValue" name = "date" value="<%- params.date %>">            
                <% for(let entry of data.roster){ %>
                    <% let student = entry.studentInfo %>
                    <% let course = entry.entry.course %>
                    <div class="form-row">
                        <div class="col-xs-6">
                            <%- `${student.lName}, ${student.fName}` %>
                        </div>

                        <% let isSelected = {"-": "", "p": "", "b": "", "a": "", "e": "", "l":""} %>
                        <% for(let a of data.attendance){  
                            if(a.lName==student.lName && a.fName == student.fName) {
                                isSelected[a.atsCode] = "selected";
                            }
                        } %>
                    
                        <div class="form-group col-xs-6">
                            <input type="hidden" name="courseId" value="<%- course %>">
                            <select class="form-control" id="<%- student._id %>" name="<%- student._id %>" >
                                <option value="-" <%- isSelected["-"] %>> </option>
                                <option value="p" <%- isSelected["p"] %>>Present (remote)</option>
                                <option value="b" <%- isSelected["b"] %>>Present (hybrid)</option>
                                <option value="a" <%- isSelected["a"] %>>Absent (unexcused)</option>
                                <option value="e" <%- isSelected["e"] %>>Absent (excused)</option>
                                <option value="l" <%- isSelected["l"] %>>Late</option>
                            </select>
                        </div>
                    </div>
                <% } %>

            <div class="form-actions">
                <button type="submit" class="btn btn-primary" >Submit attendance</button>
            </div>
        </form>
        
    </body>
</html>